#![no_main]
use libfuzzer_sys::fuzz_target;
use caramel_client::certs::create_csr;

const WORKAROUND_CACERT: &str = "-----BEGIN CERTIFICATE-----
MIIGhjCCBG6gAwIBAwIBADANBgkqhkiG9w0BAQ0FADCBhjELMAkGA1UEBhMCU0Ux
EDAOBgNVBAsMB0NhcmFtZWwxEzARBgNVBAcMCkxpbmvDtnBpbmcxETAPBgNVBAoM
CE1vZGlvIEFCMRcwFQYDVQQIDA7DlnN0ZXJnw7Z0bGFuZDEkMCIGA1UEAwwbQ2Fy
YW1lbCBTaWduaW5nIENlcnRpZmljYXRlMB4XDTE0MDYwOTE3MjY1NVoXDTM0MDYw
OTE3MjY1NVowgYYxCzAJBgNVBAYTAlNFMRAwDgYDVQQLDAdDYXJhbWVsMRMwEQYD
VQQHDApMaW5rw7ZwaW5nMREwDwYDVQQKDAhNb2RpbyBBQjEXMBUGA1UECAwOw5Zz
dGVyZ8O2dGxhbmQxJDAiBgNVBAMMG0NhcmFtZWwgU2lnbmluZyBDZXJ0aWZpY2F0
ZTCCAiIwDQYJKoZIhvcNAQEBBQADggIPADCCAgoCggIBALb+k4N44USm+Ukdptiu
wfNADSibfSZp3ACV9o+FJmpeq/bsEo4I8BCyfFQhU/QHZFZHd7yqqNOD0CvZcxeg
obHH2FK6S2WN3QHpNyy0RUuQ8x8+57j3vxk0Hx9GWoXYQuzib2eCLbhYTQq+E+5+
Y12NJxT3j1r76mzL9Ngztme3tVE5/VunGGU0t2m/AWNf1IKMysVVcn6ZM2GUIj8O
M9ip2nvXK9A5xuTvBij+FLDt8Lna+V+BiLGtRe3S0HUy/otGUGXTdVgCzQYWidxW
NLnFslQtiOgU79QfVAiINg9C+JQl9h0avtEhjS/B/dzJlo0WpQ/3LmunkJG/nlwd
f6KCdC3DNVHElngKETHCfusiHK3duMwl/JCUn5MgFzPTBslHWVUGJeSmUhU83sPR
VDLpKqYN+aNkp6+e1FzSseTaZI34zPyMZ+hlfUwVtDfRHZnSuwbkBuRMoSbSTR4j
bAMnnVQvvKzejbVfKBzZbZnqEG1lTERkj4a5fyC7gj+lgladgWpxFI2xd6P6JZDc
54YIFYyxGipUYUsSH+2JcLMxs3r7ZfRTzHaaXZaaik9iu/GhcstwO61LZlsd0vEX
sVO0u1Szj00VRcRAeiwhOEdRS8OrwDy9EsWobkd3VCOq+Qzfg3Q5xDL1XPCwU42k
K1cyeTGsCjoyIdf7Y0alP5o3AgMBAAGjgfwwgfkwEgYDVR0TAQH/BAgwBgEB/wIB
ADAOBgNVHQ8BAf8EBAMCAgQwHQYDVR0OBBYEFDtO6b/+3wjtjomvYyfJU8Y9sr0O
MIGzBgNVHSMEgaswgaiAFDtO6b/+3wjtjomvYyfJU8Y9sr0OoYGMpIGJMIGGMQsw
CQYDVQQGEwJTRTEQMA4GA1UECwwHQ2FyYW1lbDETMBEGA1UEBwwKTGlua8O2cGlu
ZzERMA8GA1UECgwITW9kaW8gQUIxFzAVBgNVBAgMDsOWc3RlcmfDtnRsYW5kMSQw
IgYDVQQDDBtDYXJhbWVsIFNpZ25pbmcgQ2VydGlmaWNhdGWCAQAwDQYJKoZIhvcN
AQENBQADggIBAE3Mqsya09FrFlf90ZkXH+7KyIBskTBTQggKPCsuHNfOSCW5akcQ
aFUZrjcFO4M4ZNcBpgBMng8IsU073+9aRlnbphpN28AFtGhc1nph1MaDpwuwsNBz
aBuHFwR+K1V/gtP7sQDnRUsPBLgT5Gg4dFAKyUTbyJdoGVbdX51TA2cm1fFkZJlm
vhaRgcby62Qm1dqMCW9r3XGobCkiINk6pHxdcWpZXX/sGlXwJnLdkn54AZ4aTH50
W4X3R08sRtP+hJUMJLw6u828VzT5t3CAWTIxZ3pQvUn1ePJcUiCCIViv1e4rlo2V
RUY9vvPTJhRmF/xbXD4xtGVTv8nrM0XSOFcENwn9ZXHZDKSt73jqxBqdmppwrTDT
f5lrEuuZrj26unnjSbnmAFz7BaS6rh6ZEBcaT7YgCPpd12FaJcr+7lNAUkFmkOvf
yj79XkWIgXnBOjtYve5aBRC46FcMkQkNhVfCU/e3uCp2l/Rc36hEm57OANtJbgLV
LDiYaWm3h7oVIRoG4WoBSBMLSQUgleQpX3IEiwO97vxjWkAdHA8IMI3HDUE9nnTi
mn1gxVw4FJ5FW9Jv0sBlS7RJHjGQnMb1eD2Whr+Dad1VBLNoAVdIKZZ1OT+mHYas
AW5slDlhh7vbggdS77Ocmq1FiaIT6xPF+CE4BmrO4GvLYDpi55FlUBOB
-----END CERTIFICATE-----
";

const VALID_KEY_DATA1: &str = "-----BEGIN RSA PRIVATE KEY-----
MIIEowIBAAKCAQEAtHkqLKRbMYyyQ0diUtuLW/kpZdxIAji9fjdOK1RJXZz8GKiz
w2EF3vT0IQ3fdF4CW1eF6WFfdu8bpCAQBbkTHvMsqR9xuPiSlIw2RN3NOVxknTon
RS7VO+FSxfQSdSCPYpFITVCCrRpa7IK1Mp8C+RygM/rbC6aKxKREq8Kkw2PFkC74
s+Q+TL9VpnHWppUfDLf5n6e5Yu0l8hChz98btnbsMZw1PwtZn86oe5QFw6TjkepY
X7IXt3JUlvqVAMlI++6M7HRaS1qcigumvz+uK/yxpKQ3vLJnjfbdnilHDYJo+Atp
ziGt16NUJgv7GJb+nMzUBegMNqRqAH7uoZy9kQIDAQABAoIBAGP4+rPgF+RK3DUI
xh7AH2LDk3spm3oflFjmqha2ii2hWMUQLwR8KpRnfRUSakY8DXIr+bJejlOEAPva
BwYkj8MFUigdkxG0IP7I7QcZFyY/WD0AieB5IQYau4+MtOzNLKCdej/Z6Yman+OE
RHvWOf9lLBmfTNgXWae0l5XOLRdOr0N59a9BfNeyODt4CfrBJ7QaM0F/H2s0pFzL
Yce7zUtGHKLDLiD6AsiV8JpeG1Ab+MMKsU3RRShvww8AsP0OyDfJclUCi+9v3tNJ
6SnEad0qzWJ7PMEJwGTXhlYYDMXv7xgpdus9AOV+9HsuZGqOgsDu7VRoClxL1hy7
kfIhDUECgYEA3y64NfwpYokOcDVYNy8q9Ny55htClUH3P05JTwijNderQqrDvAeh
RKEGRR8wqt3TzQ1iPiq92ShUHQArw3UpIcXfc78rPO9ptOBU7aiF1ggAvk4MTjOf
I/uAP0b0COSqreajcCIHoQwiqqcJsuYzmc30LebrIttqPbad4xlkGxcCgYEAzwK9
GU1l7cBs+eEiKME8kO8ay3PLBAN8DY3kcTgTeJsTlrw2kDQVxnNh4NH1/NBxAuSi
XCZEx8x1zRdKBgZhf4HAufak1bOF2KKLT3VnOxO0WFX37oao+QEzomtNXf2Khd7M
2Ot7VRkgk+AEp3iLdzPQFiH/EFz9HiACVnbTNZcCgYBDJSYsr7mvuHZMkfABYkJ1
Orb/ILJuf1Moi6AIlBuuRj1zKDcNKep94EgnoZOdxHFFXsJw26EUZUqxEu0Xt/bw
/zwT8a7LfWf7EAbdHXduhifbGVYgbO1zAOZ7oxgmWM101k/Tm5lZ/XGsj+aeGR3r
JwhQiwmxCfwzpu5ndaslbwKBgQDF7FRokLvX6ZdIApzqYndKC5KO25NLrxk4zGWS
ao8TTRIZmLKChYocR81ZauXKZnDm1zr06BHzBeXLxWyc/hTSGHjwVIWdXRun2SFh
Q1sD/P79RpTalh2QljmMHRPHvdZn0HIDJIKzBmdDe3h3tqWBvyRBRRfdyUqpNumF
Se7+2QKBgAVYMQadBE2WSyzjOpzgIz/7xGA8y+DkYPcQelc7kSJvTEZFVDfMBktd
n2+g4Al8cu6674THUVHzzr5bmZJ/XQFT6KQhG1KRlCiikOFhgoaEUU2Sy6myon3K
2S5luFEBVaDbYLvPa4Jp1tjiIT4QggCtJnq9OV0yzI6SYvJZjslC
-----END RSA PRIVATE KEY-----
";



fuzz_target!(|data: &[u8]| {
    let valid_key = VALID_KEY_DATA1.as_bytes().to_vec();
    let ca_cert = WORKAROUND_CACERT.as_bytes().to_vec();
    if let Ok(client_id) = std::str::from_utf8(data) {
        let _ = create_csr(&ca_cert, &valid_key, client_id);
    }
});
